<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml"
         xmlns:flippy="components.*" 
		 xmlns:view="com.flippy.fl.view.*" 
		 width="100%" height="100%" creationComplete="init()">
	
	<mx:Script>
		<![CDATA[
			import com.flippy.fl.model.FlippyModelLocator;
			import flash.events.Event;
			import flash.events.MouseEvent;
			import mx.containers.*;
			import mx.controls.*;
		
			[Bindable]
			public var model:FlippyModelLocator = FlippyModelLocator.getInstance();
		
			public function init():void {
				var resp:Responder = new Responder(onResult, onStatus);
				FlippyModelLocator.getInstance().logger.logMessage("member call","member info");
				FlippyModelLocator.getInstance().main.businessNc.call("member.findByUserName", resp, model.main.userName);
			}
			
			private function onResult(object:Object):void {
				FlippyModelLocator.getInstance().logger.logMessage("result member info: " + object.city + "," + object.dtlastlogin + "," + object.userName + "," + object.roleName,"member info");
			}
	
			private function onStatus(object:Object):void {			
				FlippyModelLocator.getInstance().logger.logMessage("fault member info: " + object,"member info");
			}
	
			
			public function sendChat():void {
				cp.sendChatRequest(chatName.text);
			}
			
			public function disableTopic():void {
				cp.disableTopic("session1.public", "$flippy:sys$mendisable room ini");
			}
			
			public function enableTopic():void {
				cp.enableTopic("session1.public", "$flippy:sys$mengenable room ini");
			}
			
			public function showPopupMenu(event:MouseEvent):void {
				var myMenu:Menu = Menu.createMenu(null, myMenuData, false);
                myMenu.labelField="@label";
                myMenu.show(event.stageX,event.stageY);
				
			}
			
			public function rollOver(event:MouseEvent):void {
				Label(event.target).setStyle("textDecoration","underline");
			}
			
			public function rollOut(event:MouseEvent):void {
				Label(event.target).setStyle("textDecoration","none");
			}
			
			
			
		]]>
	</mx:Script>
	<!-- Define the menu data. -->
	<mx:XML format="e4x" id="myMenuData">
		<root>
			<menuitem label="MenuItem A" >
				<menuitem label="SubMenuItem A-1" enabled="false"/>
				<menuitem label="SubMenuItem A-2"/>
			</menuitem>
			<menuitem label="MenuItem B" type="check" toggled="true"/>
			<menuitem label="MenuItem C" type="check" toggled="false"/>
			<menuitem type="separator"/>     
			<menuitem label="MenuItem D" >
				<menuitem label="SubMenuItem D-1" type="radio" 
					groupName="one"/>
				<menuitem label="SubMenuItem D-2" type="radio" 
					groupName="one" toggled="true"/>
				<menuitem label="SubMenuItem D-3" type="radio" 
					groupName="one"/>
			</menuitem>
		</root>
	</mx:XML>
	
	<mx:HDividedBox width="100%" height="100%" >
		<mx:VBox height="100%">
			<mx:Panel width="100%" height="90%">
				<mx:Label text="{model.main.sessionId}" click="showPopupMenu(event)" rollOver="rollOver(event)" rollOut="rollOut(event)"/>
				<mx:Label text="{model.main.userName}"/>
				<mx:Label text="{model.main.password}"/>
				<mx:Label text="{model.main.role}"/>
			</mx:Panel>
			<mx:VBox>
				<mx:VideoDisplay id="vdisp" />
				<mx:HBox width="100%" >
					<mx:Button label="Start Audio"/>
					<mx:Button label="Stop Audio"/>
				</mx:HBox>
			</mx:VBox>
		</mx:VBox>
		<mx:Panel width="80%" height="100%">
			<flippy:Whiteboard serverUrl="rtmp://localhost:1935/flippy" />
			<mx:HBox>
				<mx:Button label="chat to" click="sendChat()"/>
				<mx:TextInput id="chatName" text="flippy"/>
			</mx:HBox>
			<mx:Button label="disable public" click="disableTopic()"/>
			<mx:Button label="enable public" click="enableTopic()"/>
			<mx:HBox width="100%">
				<flippy:ChatPanel id="cp" sessionId="session1" from="{model.main.userName}" serverURL="rtmp://localhost:1935/flippy"/>	
				<view:QuestionBox id="qb" enabled="{model.main.enableQuestionBox}"/>
			</mx:HBox>
		</mx:Panel>	
	</mx:HDividedBox>
	
	
</mx:VBox>
