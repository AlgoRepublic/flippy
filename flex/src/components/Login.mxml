<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" verticalAlign="middle" horizontalAlign="center" creationComplete="init()">
	<mx:Script>
		<![CDATA[
			import mx.events.ValidationResultEvent;
			import mx.validators.Validator;

			[Bindable]
			public var loginInfo:LoginInfo;
			
			// ------------ Init
			public function init():void {
				txtUserName.setFocus();
				focusManager.defaultButton = btnLogin;
			}
			
			// ------------ GUI Logic
			public function validate():void {
				if (userNameValidator.validate().type == ValidationResultEvent.VALID
				    && passwordValidator.validate().type == ValidationResultEvent.VALID) {
				
					var valid:Boolean = false;
					
					loginInfo = new LoginInfo(txtUserName.text, txtPwd.text, cbRem.selected);
					
					// do query
					valid = doQuery();
					
					trace(loginInfo.userName);
					trace(loginInfo.password);
					trace(loginInfo.rememberMe);
					
					if (valid) {
						dispatchEvent(new Event("authorized"));
					} else {
						doInvalid("Invalid UserName or Password");
					}
				} else {
					doInvalid("Please fill the required fields with valid information");
				}
			}
			
			public function doInvalid(errMsg:String):void {
				clearAll();
				lblErr.text = errMsg;
				moveEffect.play();
			}
			
			public function clearAll():void {
				//lblErr.text = "";
				//txtUserName.text = "";
				txtPwd.text = "";
				//cbRem.selected = false;
			}
			
			// -------------- Authentication logic
			public function doQuery():Boolean {
				if (loginInfo.userName == "hendra" && loginInfo.password == "manager") {
					return true;
				}
				return false;
			}
		]]>
	</mx:Script>
	<mx:Metadata>
		[Event(name="authorized")]
	</mx:Metadata>
	
	<mx:StringValidator id="userNameValidator" source="{txtUserName}" property="text" required="true"/>
	<mx:StringValidator id="passwordValidator" source="{txtPwd}" property="text" required="true" />
	
	<mx:Parallel id="moveEffect" target="{loginPanel}">		
		<mx:Sequence repeatCount="4" >
			<mx:Move duration="20" xBy="10" yBy="10"/>
			<mx:Move duration="30" xBy="-20" yBy="-20"/>
			<mx:Move duration="20" xBy="10" yBy="10"/>
		</mx:Sequence>
	</mx:Parallel>
	
	<mx:Panel id="loginPanel" width="330" height="240" title="Login">
		<mx:Form>
			<mx:FormItem label="User Name">
				<mx:TextInput id="txtUserName" />
			</mx:FormItem>
			<mx:FormItem label="Password">
				<mx:TextInput id="txtPwd" displayAsPassword="true" />
			</mx:FormItem>
			<mx:FormItem>
				<mx:Button id="btnLogin" label="Login" click="validate()"/>
			</mx:FormItem>
			<mx:FormItem>
				<mx:CheckBox id="cbRem" label="Remember Me"/>
			</mx:FormItem>
			<mx:FormItem>
				<mx:Label id="lblErr" color="#F1240E" width="100%"/>
			</mx:FormItem>
		</mx:Form>
	</mx:Panel>
</mx:VBox>
